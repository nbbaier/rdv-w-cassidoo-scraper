---
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
   const questions = await getCollection("questions");
   questions.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

   return questions.map((question, index) => ({
      params: { slug: question.slug },
      props: {
         question,
         prevQuestion: index > 0 ? questions[index - 1] : null,
         nextQuestion:
            index < questions.length - 1 ? questions[index + 1] : null,
      },
   }));
}

const { question, prevQuestion, nextQuestion } = Astro.props;
const { Content } = await question.render();

const date = new Date(question.data.date).toLocaleDateString("en-US", {
   weekday: "long",
   year: "numeric",
   month: "long",
   day: "numeric",
});
---

<Layout
   title={`Question #${question.data.number} - Cassidoo's Interview Questions`}
>
   <div class="rounded-xl border bg-card text-card-foreground shadow prose prose-slate max-w-none">
      <div class="p-8">
         <div
            class="grid grid-cols-3 items-center mb-6 not-prose pb-6 border-b border-slate-100"
         >
            <div class="justify-self-start">
               {
                  prevQuestion && (
                        <a
                           href={`/questions/${prevQuestion.slug}`}
                           class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 flex items-center gap-2"
                        >
                           <Icon name="lucide:chevron-left" class="size-4" />
                           <span class="text-sm text-muted-foreground">
                              #{prevQuestion.data.number}
                           </span>
                        </a>
                  )
               }
            </div>
            <div class="justify-self-center">
                  <a href="/" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-9 px-3">All questions</a>
            </div>
            <div class="justify-self-end">
               {
                  nextQuestion && (
                        <a
                           href={`/questions/${nextQuestion.slug}`}
                           class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 flex items-center gap-2"
                        >
                           <span class="text-sm text-muted-foreground">
                              #{nextQuestion.data.number}
                           </span>
                           <Icon name="lucide:chevron-right" class="size-4" />
                        </a>
                  )
               }
            </div>
         </div>

         <div class="flex items-center justify-between mb-6 not-prose">
            <span
               class="inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-transparent"
            >
               #{question.data.number}
            </span>
            <time class="text-sm text-slate-500">{date}</time>
         </div>

         <div class="markdown-content">
            <Content />
         </div>

         <div class="mt-8 pt-6 border-t border-slate-100 not-prose">
            <!-- Bottom links -->
            <div class="flex justify-between items-center">
                  <a href="/" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 text-primary underline-offset-4 hover:underline h-10 px-4 py-2">← Back to all questions</a>
                  <a
                     href={question.data.url}
                     target="_blank"
                     rel="noopener noreferrer"
                     class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-9 px-3"
                  >
                     View original newsletter ↗
                  </a>
            </div>
         </div>
      </div>
   </div>
</Layout>

<style is:global>
   /* Custom styling for the markdown content to look nice */
   .markdown-content h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #0f172a;
      margin-top: 0;
      margin-bottom: 1rem;
   }
   .markdown-content p {
g      margin-bottom: 1rem;
      line-height: 1.625;
      color: #334155;
   }
   .markdown-content pre {
      background-color: #0f172a;
      color: #f8fafc;
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      margin-bottom: 1.5rem;
   }
   .markdown-content code {
      background-color: #f1f5f9;
      color: #db2777;
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      font-family:
         ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
   }
   .markdown-content pre code {
      background-color: transparent;
      color: inherit;
      padding: 0;
      font-size: 0.875rem;
   }
   .markdown-content ul {
      list-style-type: disc;
      list-style-position: outside;
      margin-left: 1.5rem;
      margin-bottom: 1rem;
      color: #334155;
   }
   .markdown-content ul > li + li {
      margin-top: 0.25rem;
   }
   .markdown-content li {
      padding-left: 0.25rem;
   }
</style>
