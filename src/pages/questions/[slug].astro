---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
	const questions = await getCollection("questions");
	questions.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

	return questions.map((question, index) => ({
		params: { slug: question.slug },
		props: {
			question,
			prevQuestion: index > 0 ? questions[index - 1] : null,
			nextQuestion: index < questions.length - 1 ? questions[index + 1] : null,
		},
	}));
}

const { question, prevQuestion, nextQuestion } = Astro.props;
const { Content } = await question.render();

const date = new Date(question.data.date).toLocaleDateString("en-US", {
	weekday: "long",
	year: "numeric",
	month: "long",
	day: "numeric",
});
---

<Layout
   title={`Question #${question.data.number} - Cassidoo's Interview Questions`}
>
   <article
      class="prose prose-slate max-w-none bg-white p-8 rounded-xl shadow-sm border border-slate-100"
   >
      <div class="flex items-center justify-between mb-6 not-prose">
         <span
            class="text-sm font-semibold text-indigo-600 bg-indigo-50 px-3 py-1 rounded-full"
         >
            #{question.data.number}
         </span>
         <time class="text-sm text-slate-500">{date}</time>
      </div>

      <div class="markdown-content">
         <Content />
      </div>

      <div class="mt-8 pt-6 border-t border-slate-100 not-prose">
         <!-- Navigation arrows -->
         <div class="flex justify-between items-center mb-4">
            {prevQuestion ? (
               <a
                  href={`/questions/${prevQuestion.slug}`}
                  class="text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-2 group"
               >
                  <span>← Previous</span>
                  <span class="text-sm text-slate-500 group-hover:text-slate-700">
                     #{prevQuestion.data.number}
                  </span>
               </a>
            ) : (
               <div></div>
            )}
            {nextQuestion ? (
               <a
                  href={`/questions/${nextQuestion.slug}`}
                  class="text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-2 group"
               >
                  <span class="text-sm text-slate-500 group-hover:text-slate-700">
                     #{nextQuestion.data.number}
                  </span>
                  <span>Next →</span>
               </a>
            ) : (
               <div></div>
            )}
         </div>

         <!-- Back and original links -->
         <div class="flex justify-between items-center">
            <a
               href="/"
               class="text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-2"
            >
               ← Back to all questions
            </a>
            <a
               href={question.data.url}
               target="_blank"
               rel="noopener noreferrer"
               class="text-slate-500 hover:text-slate-700 text-sm flex items-center gap-1"
            >
               View original newsletter ↗
            </a>
         </div>
      </div>
   </article>
</Layout>

<style is:global>
   /* Custom styling for the markdown content to look nice */
   .markdown-content h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #0f172a;
      margin-top: 0;
      margin-bottom: 1rem;
   }
   .markdown-content p {
      margin-bottom: 1rem;
      line-height: 1.625;
      color: #334155;
   }
   .markdown-content pre {
      background-color: #0f172a;
      color: #f8fafc;
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      margin-bottom: 1.5rem;
   }
   .markdown-content code {
      background-color: #f1f5f9;
      color: #db2777;
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      font-family:
         ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
   }
   .markdown-content pre code {
      background-color: transparent;
      color: inherit;
      padding: 0;
      font-size: 0.875rem;
   }
   .markdown-content ul {
      list-style-type: disc;
      list-style-position: outside;
      margin-left: 1.5rem;
      margin-bottom: 1rem;
      color: #334155;
   }
   .markdown-content ul > li + li {
      margin-top: 0.25rem;
   }
   .markdown-content li {
      padding-left: 0.25rem;
   }
</style>
